# Настройка счетчика Яндекс.Метрики

## Описание

Код счетчика Яндекс.Метрики добавлен на все страницы сайта для отслеживания посещений и поведения пользователей.

## ID счетчика

**ID счетчика:** `103855878`

## Размещение кода

Код счетчика размещен в двух местах для обеспечения максимальной надежности:

### 1. В `<head>` секции (layout.tsx)
- Использует стратегию `beforeInteractive` для максимально ранней загрузки
- Обеспечивает отслеживание даже при быстром закрытии страницы
- Код размещен как можно ближе к началу страницы

### 2. В компоненте Analytics
- Дублирует функциональность для дополнительной надежности
- Использует переменные окружения для гибкости настройки

## Конфигурация

Счетчик настроен со следующими параметрами:

```javascript
ym(103855878, 'init', {
  ssr: true,                    // Поддержка SSR
  webvisor: true,               // Вебвизор
  clickmap: true,               // Карта кликов
  ecommerce: "dataLayer",       // E-commerce
  accurateTrackBounce: true,    // Точное отслеживание отказов
  trackLinks: true              // Отслеживание ссылок
});
```

## Переменные окружения

В файле `env.production` установлен ID счетчика:

```bash
NEXT_PUBLIC_YANDEX_ID=103855878
```

## Проверка работы

### Тестовая страница
Создана страница `/test-analytics` для проверки работы счетчика.

### Ручная проверка
1. Откройте любую страницу сайта
2. Нажмите F12 для открытия консоли разработчика
3. Перейдите на вкладку Network
4. Обновите страницу
5. Найдите запросы к `mc.yandex.ru`
6. Проверьте отсутствие ошибок JavaScript

### Проверка в Яндекс.Метрике
1. Войдите в [Яндекс.Метрику](https://metrika.yandex.ru/)
2. Выберите счетчик с ID `103855878`
3. Проверьте, что данные поступают в реальном времени

## Структура файлов

- `src/app/layout.tsx` - основной код счетчика в head
- `src/components/Analytics.tsx` - дублирующий код счетчика
- `env.production` - переменные окружения
- `src/app/test-analytics/page.tsx` - тестовая страница

## Особенности реализации

1. **Ранняя загрузка**: Код загружается до интерактивности страницы
2. **SSR поддержка**: Настроен для работы с серверным рендерингом
3. **Fallback**: Дублирование кода обеспечивает надежность
4. **Переменные окружения**: Гибкая настройка для разных окружений

## Устранение неполадок

### Счетчик не работает
1. Проверьте правильность ID в переменных окружения
2. Убедитесь, что нет блокировщиков рекламы
3. Проверьте консоль на наличие ошибок JavaScript

### Данные не поступают
1. Проверьте настройки счетчика в Яндекс.Метрике
2. Убедитесь, что домен добавлен в настройки счетчика
3. Проверьте фильтры и цели в настройках

## Дополнительные возможности

Компонент `YandexGoals` предоставляет дополнительные функции:
- Отслеживание форм
- Отслеживание звонков
- Отслеживание просмотров услуг
- Отслеживание времени на сайте
- Отслеживание глубины прокрутки

## Контакты

При возникновении проблем с работой счетчика обратитесь к администратору сайта.
